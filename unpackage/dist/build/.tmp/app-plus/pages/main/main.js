(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/main/main"],{"03a5":function(t,e,n){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n("2f62");a(n("6a9e"));function a(t){return t&&t.__esModule?t:{default:t}}function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),i.forEach(function(e){r(t,e,n[e])})}return t}function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var u=function(){return n.e("components/wuc-tab/wuc-tab").then(n.bind(null,"c27e"))},c=function(){return Promise.all([n.e("common/vendor"),n.e("components/QS-inputs-split/elements/QS-input/index")]).then(n.bind(null,"d885"))},d=function(){return Promise.all([n.e("common/vendor"),n.e("components/QS-inputs-split/elements/QS-textarea/index")]).then(n.bind(null,"513b"))},l=function(){return n.e("node-modules/@dcloudio/uni-ui/lib/uni-popup/uni-popup").then(n.bind(null,"33b9"))},f=function(){return n.e("node-modules/@dcloudio/uni-ui/lib/uni-list/uni-list").then(n.bind(null,"3aa5"))},g=function(){return n.e("node-modules/@dcloudio/uni-ui/lib/uni-list-item/uni-list-item").then(n.bind(null,"f38b"))},h=function(){return n.e("node-modules/@dcloudio/uni-ui/lib/uni-drawer/uni-drawer").then(n.bind(null,"8357"))},m=function(){return Promise.all([n.e("common/vendor"),n.e("components/QS-inputs-split/elements/QS-pics/index")]).then(n.bind(null,"5607"))},p=function(){return n.e("node-modules/@dcloudio/uni-ui/lib/uni-icons/uni-icons").then(n.bind(null,"26de"))},v=function(){return n.e("node-modules/@dcloudio/uni-ui/lib/uni-number-box/uni-number-box").then(n.bind(null,"0e09"))},b={computed:(0,o.mapState)(["forcedLogin","hasLogin","userName","serverUrl","user"]),components:{wucTab:u,QSInput:c,QSTextarea:d,uniPopup:l,uniList:f,uniListItem:g,uniDrawer:h,QSPics:m,uniIcons:p,uniNumberBox:v},data:function(){var t;return{visible:!1,curStep:0,step:[!0,!1,!1],step2:[!1,!1],title:"map",latitude:39.909,longitude:116.39742,cargoImage:[{name:"cargoImage"},{name:"cargoImage2"},{name:"cargoImage3"}],covers:[{id:1,title:"当前位置",latitude:39,longitude:116,iconPath:"../../static/img/location_self.png"}],circles:[{id:1,latitude:39,longitude:116,radius:1e3,fillColor:"#FFFFF00"}],wH:"",addressList1:[],addressList2:[],carList:[{name:"我要寄货",url:"../../static/img/car/ji.jpg",startPrice:50,startDistance:500,averagePrice:10,desc:"注册要到某地的信息，等顺路人拿走您的包裹，送到你的目的地"},{name:"我要带货",url:"../../static/img/car/na.jpg",startPrice:50,startDistance:500,averagePrice:10,desc:"前往到某地，顺便帮助途中路径的包裹，收取一定费用"}],TabCur:0,aroundTime:"",imageArray:[],userPoint:(t={consignee:{name:"",phone:""},goods:{name:"",volume:"",weight:"",detail:""},tbuser:{},distance:"",address:"",toaddress:"",money:""},r(t,"distance",""),r(t,"cargoImage",""),r(t,"location",{type:"",coordinates:[]}),r(t,"location2",{type:"",coordinates:[]}),t),entity:{},tempEntity:{address:"",latitude:"",longitude:""}}},methods:s({},(0,o.mapMutations)(["login","updateUser"]),{bindChange1:function(t){this.userPoint.goods.volume=t},bindChange2:function(t){this.userPoint.goods.weight=t},chooseToAddress:function(){var e=this;t.chooseLocation({success:function(t){var n=t.latitude,i=t.longitude,o=t.address,a="";for(var s in o)void 0!=o[s]&&(a+=o[s]);e.tempEntity.address=a,e.tempEntity.latitude=n,e.tempEntity.longitude=i}})},uploadImage:function(t,e){this.imageArray.push(e)},markClick:function(e){var n=e.markerId;t.navigateTo({url:"../cargo/cargo/cargo?id="+n})},searAddress:function(e){var n={};if(1==e)this.userPoint.address;else this.userPoint.toaddress;var i=this;t.chooseLocation({success:function(t){n.name=t.name,n.address=t.address,n.latitude=t.latitude,n.longitude=t.longitude;var o=t.address,a="";for(var s in o)void 0!=o[s]&&(a+=o[s]);if(1==e){i.userPoint.address=a;var r={type:"Point"};r.coordinates=[n.longitude,n.latitude],i.latitude=n.latitude,i.longitude=n.longitude,i.covers[0].longitude=n.longitude,i.covers[0].latitude=n.latitude,i.circles[0].longitude=n.longitude,i.circles[0].latitude=n.latitude,i.userPoint.location=r}if(2==e){i.userPoint.toaddress=a;r={type:"Point"};r.coordinates=[n.longitude,n.latitude],i.userPoint.location2=r}}})},nextStep:function(){var e=this;if(2!=this.curStep)if(1==this.curStep){if(0==this.TabCur){if(!this.checkInput())return;t.hideLoading();var n=this,i={mode:"driving",key:"LHYBZ-SYJLJ-VDKFC-F2KAI-WACOK-S6FMJ",from:n.userPoint.location.coordinates[1]+","+n.userPoint.location.coordinates[0],to:n.userPoint.location2.coordinates[1]+","+n.userPoint.location2.coordinates[0],output:"JSON"};t.request({url:"https://apis.map.qq.com/ws/distance/v1/",method:"GET",data:i,header:{},success:function(t){var i=t.data.result.elements[0].distance,o=t.data.result.elements[0].duration;n.aroundTime=o,n.userPoint.distance=i,i>n.carList[n.TabCur].startDistance?n.userPoint.money=n.carList[n.TabCur].startPrice+(i-n.carList[n.TabCur].startDistance)*n.carList[n.TabCur].averagePrice:n.userPoint.money=n.carList[n.TabCur].startPrice,e.curStep++;for(var a=0;a<3;a++)a==e.curStep?e.step[a]=!0:e.step[a]=!1},fail:function(n){t.showToast({icon:"none",title:"请求距离失败,仅支持10公里计算距离"}),e.curStep++;for(var i=0;i<3;i++)i==e.curStep?e.step[i]=!0:e.step[i]=!1}})}}else{this.curStep++;for(var o=0;o<3;o++)o==this.curStep?this.step[o]=!0:this.step[o]=!1}},preStep:function(){if(0!=this.curStep){this.curStep--;for(var t=0;t<3;t++)t==this.curStep?this.step[t]=!0:this.step[t]=!1}},tabChange:function(t){this.TabCur=t},swiperChange:function(t){var e=t.target.current;this.TabCur=e},toLogin:function(){var e=this;console.log(i("是否强制登录？"+this.forcedLogin," at pages\\main\\main.vue:481")),this.forcedLogin?t.reLaunch({url:"../login/login"}):t.showModal({title:"未登录",content:"您未登录，需要登录后才能继续",showCancel:!this.forcedLogin,success:function(n){n.confirm&&(e.forcedLogin?t.reLaunch({url:"../login/login"}):t.navigateTo({url:"../login/login"}))}})},searchCargo:function(){if(this.tempEntity.latitude&&this.longitude){var e=this;e.covers.splice(1,e.covers.length-1),t.showLoading({title:"请求数据中.."});var n=e.tempEntity.longitude,o=e.tempEntity.latitude,a=1e4;t.request({url:e.serverUrl+"/user/userPoint/getNearCargo/"+o+"/"+n+"/"+a,method:"POST",data:e.userPoint,header:{"content-type":"application/json"},success:function(n){console.log(i(n.data," at pages\\main\\main.vue:551"));var o=n.data.content;o.forEach(function(t){var n=t.content.location,i={id:t.content.id,title:t.content.goods.name,latitude:n.coordinates[1],longitude:n.coordinates[0],iconPath:"../../static/img/car/cargo.png"};e.covers.push(i)}),t.hideLoading(),t.showToast({icon:"none",title:"请求成功！检索到与你目的地一致的包裹："+o.length}),e.curStep=0,e.step[1]=!1,e.step[2]=!1,e.step[0]=!0},fail:function(e){t.showToast({icon:"none",title:"请求失败"})}})}else t.showToast({icon:"none",title:"请先选择目的地"})},searchCar:function(){if(this.checkInput()){var e=this;t.showModal({title:"提示",content:"确认提交订单?提交后将可能被顺路者带走",success:function(n){if(n.confirm)t.showLoading({title:"请求中.."}),e.userPoint.user_id=e.user.id,e.userPoint.tbUser=e.user,e.userPoint.cargoImage=JSON.stringify(e.imageArray),e.userPoint.status=1,t.request({url:e.serverUrl+"/user/userPoint/save",method:"POST",data:e.userPoint,header:{"content-type":"application/json"},success:function(n){n.data.status?(t.hideLoading(),t.showToast({icon:"none",title:"保存成功"}),e.curStep=0,e.step[1]=!1,e.step[2]=!1,e.step[0]=!0,e.userPoint={},console.log(i(n.data.data," at pages\\main\\main.vue:636"))):t.showToast({icon:"none",title:"请求失败"})},fail:function(e){t.showToast({icon:"none",title:"网络请求失败:"+e})}});else if(n.cancel)return}})}},checkInput:function(){return 0==this.imageArray.length?(t.showToast({icon:"none",title:"至少上传一张物品图片"}),!1):""==this.userPoint.goods.name?(t.showToast({icon:"none",title:"请填写货物名"}),!1):""==this.userPoint.goods.weight?(t.showToast({icon:"none",title:"请填写货物重量"}),!1):""==this.userPoint.goods.volume?(t.showToast({icon:"none",title:"请填写货物体积"}),!1):""==this.userPoint.consignee.name?(t.showToast({icon:"none",title:"请填写收货人姓名"}),!1):""==this.userPoint.consignee.phone?(t.showToast({icon:"none",title:"请填写收货人联系电话"}),!1):""==this.userPoint.toaddress?(t.showToast({icon:"none",title:"请填写目的地址"}),!1):""!=this.userPoint.address||(t.showToast({icon:"none",title:"请填写寄件地址"}),!1)}}),onLoad:function(){var e=this,n=t.getSystemInfoSync(),o=n.windowHeight;if(this.wH=o/2,!this.hasLogin)try{var a=t.getStorageSync("token"),s=this;a?t.request({url:this.serverUrl+"/user/login/"+a,data:{},header:{},success:function(n){if(console.log(i(n," at pages\\main\\main.vue:759")),1==n.data.status){console.log(i(n.data," at pages\\main\\main.vue:761"));var o=JSON.parse(n.data.data);e.login(o.username),s.updateUser(o)}else t.showToast({icon:"none",title:"登陆已过期，请重新登录"}),setTimeout(function(){s.toLogin()},1e3)},fail:function(e){t.showToast({icon:"none",title:"自动登录失败"}),setTimeout(function(){s.toLogin()},1e3)}}):(t.showToast({icon:"none",title:"自动登录失败"}),setTimeout(function(){s.toLogin()},1e3))}catch(r){t.showToast({icon:"none",title:"请先登录"}),setTimeout(function(){s.toLogin()},1e3)}},onReady:function(){var e=this,n={};n=this.user,n.password="",this.userPoint.tbuser=n,t.getLocation({type:"gcj02",geocode:!0,success:function(t){console.log(i("当前位置的经度："+t.longitude," at pages\\main\\main.vue:821")),console.log(i("当前位置的纬度："+t.latitude," at pages\\main\\main.vue:822")),e.longitude=t.longitude,e.latitude=t.latitude,e.covers[0].longitude=t.longitude,e.covers[0].latitude=t.latitude,e.circles[0].longitude=t.longitude,e.circles[0].latitude=t.latitude;var n={type:"Point"};n.coordinates=[t.longitude,t.latitude],e.userPoint.location=n;var o=t.address,a="";for(var s in o)void 0!=o[s]&&(a+=o[s]);e.userPoint.address=a}})}};e.default=b}).call(this,n("6e42")["default"],n("0de9")["default"])},"0403":function(t,e,n){"use strict";var i,o=function(){var t=this,e=t.$createElement,n=(t._self._c,Math.round(t.aroundTime/60));t.$mp.data=Object.assign({},{$root:{g0:n}})},a=[];n.d(e,"b",function(){return o}),n.d(e,"c",function(){return a}),n.d(e,"a",function(){return i})},"24e1":function(t,e,n){"use strict";(function(t){n("daa0"),n("921b");i(n("66fd"));var e=i(n("95a1"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("6e42")["createPage"])},"688d":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i={name:"UniSegmentedControl",props:{current:{type:Number,default:0},values:{type:Array,default:function(){return[]}},activeColor:{type:String,default:"#007aff"},styleType:{type:String,default:"button"}},data:function(){return{currentIndex:0}},watch:{current:function(t){t!==this.currentIndex&&(this.currentIndex=t)}},created:function(){this.currentIndex=this.current},methods:{_onClick:function(t){this.currentIndex!==t&&(this.currentIndex=t,this.$emit("clickItem",t))}}};e.default=i},"6a9e":function(t,e,n){"use strict";n.r(e);var i=n("cb18"),o=n("d7e2");for(var a in o)"default"!==a&&function(t){n.d(e,t,function(){return o[t]})}(a);n("b046");var s,r=n("f0c5"),u=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],s);e["default"]=u.exports},"77ee":function(t,e,n){"use strict";n.r(e);var i=n("03a5"),o=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,function(){return i[t]})}(a);e["default"]=o.a},"7a6d":function(t,e,n){"use strict";var i=n("ecf0"),o=n.n(i);o.a},"95a1":function(t,e,n){"use strict";n.r(e);var i=n("0403"),o=n("77ee");for(var a in o)"default"!==a&&function(t){n.d(e,t,function(){return o[t]})}(a);n("7a6d");var s,r=n("f0c5"),u=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,"f385f736",null,!1,i["a"],s);e["default"]=u.exports},b046:function(t,e,n){"use strict";var i=n("e08b"),o=n.n(i);o.a},cb18:function(t,e,n){"use strict";var i,o=function(){var t=this,e=t.$createElement;t._self._c},a=[];n.d(e,"b",function(){return o}),n.d(e,"c",function(){return a}),n.d(e,"a",function(){return i})},d7e2:function(t,e,n){"use strict";n.r(e);var i=n("688d"),o=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,function(){return i[t]})}(a);e["default"]=o.a},e08b:function(t,e,n){},ecf0:function(t,e,n){}},[["24e1","common/runtime","common/vendor"]]]);